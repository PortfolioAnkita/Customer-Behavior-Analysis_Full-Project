USE project2; 
SELECT * FROM customer_purchases ;

-- Q1. What is the total revenue generated by male vs. female customers?
select * from customer_purchases limit 5;

DESCRIBE customer_purchases;
 
select gender, SUM(purchase_amount_usd) as revenue
from customer_purchases
group by gender;

-- Q2. Which customers used a discount but still spent more than the average purchase amount? 
select customer_id,
avg(purchase_amount_usd) as avg_purchase_amt
from customer_purchases
group by customer_id;

--  Q3. Which are the top 5 products with the highest average review rating?
select item_purchased, avg(review_rating) as avg_review_rating
from customer_purchases
group by item_purchased
order by avg_review_rating limit 5;

-- Q4. Compare the average Purchase Amounts between Standard and Express Shipping. 
select shipping_type ,avg(purchase_amount_usd) as avg_purchase_amount
from customer_purchases
where shipping_type in ('express','Standard')
group by shipping_type;

-- Q5. Do subscribed customers spend more? Compare average spend and total revenue 
SELECT subscription_status,
       COUNT(customer_id) AS total_customers,
       ROUND(AVG(purchase_amount_usd),2) AS avg_spend,
       ROUND(SUM(purchase_amount_usd),2) AS total_revenue
FROM customer_purchases
GROUP BY subscription_status
ORDER BY total_revenue,avg_spend DESC;

-- Q6. Which 5 products have the highest percentage of purchases with discounts applied?

SELECT item_purchased,
       ROUND(100.0 * SUM(CASE WHEN discount_applied = 'Yes' THEN 1 ELSE 0 END)/COUNT(*),2) AS discount_rate
FROM customer_purchases
GROUP BY item_purchased
ORDER BY discount_rate DESC
LIMIT 5;

-- Q7. Segment customers into New, Returning, and Loyal based on their total 
WITH customer_type AS (
    SELECT 
        customer_id,
        previous_purchases,
        CASE 
            WHEN previous_purchases = 1 THEN 'New'
            WHEN previous_purchases BETWEEN 2 AND 10 THEN 'Returning'
            ELSE 'Loyal'
        END AS customer_segment
    FROM customer_purchases
)

SELECT 
    customer_segment,
    COUNT(*) AS `Number of Customers`
FROM customer_type
GROUP BY customer_segment;

-- Q9. Are customers who are repeat buyers (more than 5 previous purchases) also likely to subscribe?
SELECT subscription_status,
       COUNT(customer_id) AS repeat_buyers
FROM customer_purchases
WHERE previous_purchases > 5
GROUP BY subscription_status;

-- Q10. What is the revenue contribution of each age group? 
SELECT 
    age_group,
    SUM(purchase_amount_usd) AS total_revenue
FROM customer_purchases
GROUP BY age_group
ORDER BY total_revenue desc;





